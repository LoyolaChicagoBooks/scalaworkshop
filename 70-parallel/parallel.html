<!DOCTYPE html>

<html :class="{'dark': darkMode === 'dark' || (darkMode === 'system' &amp;&amp; window.matchMedia('(prefers-color-scheme: dark)').matches)}" class="scroll-smooth" data-content_root="../" lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') || localStorage.setItem('darkMode', 'system'), activeSection: '' }" x-init="$watch('darkMode', val =&gt; localStorage.setItem('darkMode', val))">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<meta content="white" media="(prefers-color-scheme: light)" name="theme-color"/>
<meta content="black" media="(prefers-color-scheme: dark)" name="theme-color"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Basic Parallelism using Par | Scala for Computer and Data Science v0.7</title>
<meta content="Basic Parallelism using Par | Scala for Computer and Data Science v0.7" property="og:title"/>
<meta content="Basic Parallelism using Par | Scala for Computer and Data Science v0.7" name="twitter:title"/>
<link href="../_static/pygments.css?v=03e43079" rel="stylesheet" type="text/css"/>
<link href="../_static/theme.css?v=42baaae4" rel="stylesheet" type="text/css"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../80-actors/actors.html" rel="next" title="Parallelism using Actors"/>
<link href="../60-android/android.html" rel="prev" title="Mobile Application Development with Android"/>
<script>
    <!-- Prevent Flash of wrong theme -->
      const userPreference = localStorage.getItem('darkMode');
      let mode;
      if (userPreference === 'dark' || window.matchMedia('(prefers-color-scheme: dark)').matches) {
        mode = 'dark';
        document.documentElement.classList.add('dark');
      } else {
        mode = 'light';
      }
      if (!userPreference) {localStorage.setItem('darkMode', mode)}
    </script>
</head>
<body :class="{ 'overflow-hidden': showSidebar }" class="min-h-screen font-sans antialiased bg-background text-foreground" x-data="{ showSidebar: false, showScrollTop: false }">
<div @click.self="showSidebar = false" class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm md:hidden" x-cloak="" x-show="showSidebar"></div><div class="relative flex flex-col min-h-screen" id="page"><a class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100" href="#content">
      Skip to content
    </a>
<header class="sticky top-0 z-40 w-full border-b shadow-sm border-border supports-backdrop-blur:bg-background/60 bg-background/95 backdrop-blur"><div class="container flex items-center h-14">
<div class="hidden mr-4 md:flex">
<a class="flex items-center mr-6" href="../index.html"><span class="hidden font-bold sm:inline-block text-clip whitespace-nowrap">Scala for Computer and Data Science v0.7</span>
</a></div><button @click="showSidebar = true" class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden" type="button">
<svg aria-hidden="true" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z"></path>
</svg>
<span class="sr-only">Toggle navigation menu</span>
</button>
<div class="flex items-center justify-between flex-1 space-x-2 sm:space-x-4 md:justify-end">
<div class="flex-1 w-full md:w-auto md:flex-none"><form @keydown.k.window.meta="$refs.search.focus()" action="../search.html" class="relative flex items-center group" id="searchbox" method="get">
<input aria-label="Search the docs" class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" id="search-input" name="q" placeholder="Search ..." type="search" x-ref="search"/>
<kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
<span class="text-xs">⌘</span>
    K
  </kbd>
</form>
</div>
<nav class="flex items-center space-x-1">
<button @click="darkMode = darkMode === 'light' ? 'dark' : 'light'" aria-label="Color theme switcher" class="relative inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9" type="button">
<svg class="absolute transition-all scale-100 rotate-0 dark:-rotate-90 dark:scale-0" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 685q45.456 0 77.228-31.772Q589 621.456 589 576q0-45.456-31.772-77.228Q525.456 467 480 467q-45.456 0-77.228 31.772Q371 530.544 371 576q0 45.456 31.772 77.228Q434.544 685 480 685Zm0 91q-83 0-141.5-58.5T280 576q0-83 58.5-141.5T480 376q83 0 141.5 58.5T680 576q0 83-58.5 141.5T480 776ZM80 621.5q-19.152 0-32.326-13.174T34.5 576q0-19.152 13.174-32.326T80 530.5h80q19.152 0 32.326 13.174T205.5 576q0 19.152-13.174 32.326T160 621.5H80Zm720 0q-19.152 0-32.326-13.174T754.5 576q0-19.152 13.174-32.326T800 530.5h80q19.152 0 32.326 13.174T925.5 576q0 19.152-13.174 32.326T880 621.5h-80Zm-320-320q-19.152 0-32.326-13.174T434.5 256v-80q0-19.152 13.174-32.326T480 130.5q19.152 0 32.326 13.174T525.5 176v80q0 19.152-13.174 32.326T480 301.5Zm0 720q-19.152 0-32.326-13.17Q434.5 995.152 434.5 976v-80q0-19.152 13.174-32.326T480 850.5q19.152 0 32.326 13.174T525.5 896v80q0 19.152-13.174 32.33-13.174 13.17-32.326 13.17ZM222.174 382.065l-43-42Q165.5 327.391 166 308.239t13.174-33.065q13.435-13.674 32.587-13.674t32.065 13.674l42.239 43q12.674 13.435 12.555 31.706-.12 18.272-12.555 31.946-12.674 13.674-31.445 13.413-18.772-.261-32.446-13.174Zm494 494.761-42.239-43q-12.674-13.435-12.674-32.087t12.674-31.565Q686.609 756.5 705.38 757q18.772.5 32.446 13.174l43 41.761Q794.5 824.609 794 843.761t-13.174 33.065Q767.391 890.5 748.239 890.5t-32.065-13.674Zm-42-494.761Q660.5 369.391 661 350.62q.5-18.772 13.174-32.446l41.761-43Q728.609 261.5 747.761 262t33.065 13.174q13.674 13.435 13.674 32.587t-13.674 32.065l-43 42.239q-13.435 12.674-31.706 12.555-18.272-.12-31.946-12.555Zm-495 494.761Q165.5 863.391 165.5 844.239t13.674-32.065l43-42.239q13.435-12.674 32.087-12.674t31.565 12.674Q299.5 782.609 299 801.38q-.5 18.772-13.174 32.446l-41.761 43Q231.391 890.5 212.239 890t-33.065-13.174ZM480 576Z"></path>
</svg>
<svg class="absolute transition-all scale-0 rotate-90 dark:rotate-0 dark:scale-100" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 936q-151 0-255.5-104.5T120 576q0-138 90-239.5T440 218q25-3 39 18t-1 44q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q21-14 43-1.5t19 39.5q-14 138-117.5 229T480 936Zm0-80q88 0 158-48.5T740 681q-20 5-40 8t-40 3q-123 0-209.5-86.5T364 396q0-20 3-40t8-40q-78 32-126.5 102T200 576q0 116 82 198t198 82Zm-10-270Z"></path>
</svg>
</button>
</nav>
</div>
</div>
</header>
<div class="flex-1"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }" class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full shrink-0 overflow-y-auto border-r border-border md:sticky" id="left-sidebar">
<a class="!justify-start text-sm md:!hidden bg-background" href="../index.html"><span class="font-bold text-clip whitespace-nowrap">Scala for Computer and Data Science v0.7</span>
</a>
<div class="relative overflow-hidden md:overflow-auto my-4 md:my-0 h-[calc(100vh-8rem)] md:h-auto">
<div class="overflow-y-auto h-full w-full relative pr-6"><nav class="table w-full min-w-full my-6 lg:my-8">
<p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../00-preliminaries/preliminaries.html">About the Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-intro/intro.html">About Scala</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10-install/install.html">Installing Scala</a></li>
<li class="toctree-l1"><a class="reference internal" href="../20-cs1/cs1.html">Scala Essentials for Introductory CS and DS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../30-cs2/cs2.html">Scala and Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../35-datascience/datascience.html">Data Science with Scala and Smile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../40-buildtools/buildtools.html">Build Tools for Scala</a></li>
<li class="toctree-l1"><a class="reference internal" href="../50-webservices/webservices.html">Web Application and Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../60-android/android.html">Mobile Application Development with Android</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basic Parallelism using Par</a></li>
<li class="toctree-l1"><a class="reference internal" href="../80-actors/actors.html">Parallelism using Actors</a></li>
<li class="toctree-l1" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../90-pl/pl.html">Programming Language Topics<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="../90-pl/abstraction.html">Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../90-pl/representation.html">Representation</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<button @click="showSidebar = false" class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100" type="button">
<svg class="h-4 w-4" fill="currentColor" height="24" stroke="none" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z"></path>
</svg>
</button>
</aside>
<main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs" class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
<a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground" href="../index.html">
<span class="hidden md:inline">Scala for Computer and Data Science v0.7</span>
<svg aria-label="Home" class="md:hidden" fill="currentColor" height="18" stroke="none" viewbox="0 96 960 960" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z"></path>
</svg>
</a>
<div class="mr-1">/</div><span aria-current="page" class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">Basic Parallelism using Par</span>
</nav>
<div id="content" role="main">
<section id="basic-parallelism-using-par">
<h1>Basic Parallelism using Par<a class="headerlink" href="#basic-parallelism-using-par" title="Link to this heading">¶</a></h1>
<p>Using parallelism solves problems more quickly than using a
single-processor machine, as is the case where groups of people solve
problems larger than one person can solve. But just as with groups of
people, there are additional costs and problems involved in coordinating
parallel processors:</p>
<ul class="simple">
<li><p>We need to have more than one processor work on the problem at the same
time. Our machine must have more than one processor, and the operating
system must be able to give more than one processor to our program at the
same time. Kernel threads allow this in Java. An alternative approach is to
have several networked computers work on parts of the problem; this is
discussed in Chapters 11 and 12, “Networking” and “Coordination.” of the
HPJPC book by Christopher and Thiruvathukal.</p></li>
<li><p>We need to assign parts of the problem to threads. This at least requires
rewriting a sequential program. It usually requires rethinking the
algorithm as well.</p></li>
<li><p>We need to coordinate the threads so they perform their operations in the
proper order, as well as avoid race conditions and deadlocks. A number of
useful facilities are not provided by the standard Java language package.
We provide a good collection for your use in our thread package.</p></li>
<li><p>We need to maintain a reasonable grain size. Grain size refers to the
amount of work a thread does between communications or synchronizations.
Fine grain uses very few instructions between synchronizations; coarse
grain uses a large amount of work. Too fine a grain wastes too much
overhead creating and synchronizing threads. Too coarse a grain results in
load imbalance and the underutilization of processors.</p></li>
</ul>
<p>Two easy, practical approaches to dividing the work among several
processors are executing functions in parallel and executing
iterations of loops in parallel. Parallelizing loops will be presented
in the next chapter. In this chapter we will discuss running subroutines
in parallel.</p>
<p>Executing functions in parallel is an easy way to speed up
computation. The chunks of code are already packaged for you in methods;
you merely need to wrap runnable classes around them. Of course, there
are certain requirements:</p>
<ul class="simple">
<li><p>The function must be able to run in parallel with some other
computation. This usually means that there are several function
calls that can run independently.</p></li>
<li><p>The function must have a reasonable grain size. It costs a lot to
get a thread running, and it doesn’t pay off for only a few
instructions.</p></li>
</ul>
<p>Two kinds of algorithms particularly adaptable to parallel execution of
functions are the divide-and-conquer and branch-and-bound algorithms.
Divide-and-conquer algorithms break large problems into parts and solve
the parts independently. Parts that are small enough are solved simply
as special cases. You must know how to break a large problem into parts
that can be solved independently and whose solutions can be reassembled
into a solution of the overall problem. The algorithm may undergo some
cost in breaking the problem into subparts or in assembling the
solutions.</p>
<section id="example-trapezoidal-numeric-integration">
<h2>Example: Trapezoidal Numeric Integration<a class="headerlink" href="#example-trapezoidal-numeric-integration" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#example-trapezoidal-numeric-integration'">¶</a></h2>
<p>Sometimes, a program needs to integrate a function (i.e., calculate the
area under a curve). It might be able to use a formula for the integral,
but doing so isn’t always convenient, or even possible. An easy
alternative approach is to approximate the curve with straight line
segments and calculate an estimate of the area from them.</p>
<p>This visual (courtesy of HPJPC) shows the trapezoidal method:</p>
<img alt="Trapezoidal Integration Method" class="align-center" src="../_images/trapezoids.png"/>
<p>This equation shows how to calculate the area.</p>
<p>We wish to find the area under the curve from <span class="math notranslate nohighlight">\(a\)</span> to <span class="math notranslate nohighlight">\(b\)</span>. We
approximate the function by dividing the domain from <span class="math notranslate nohighlight">\(a\)</span> to <span class="math notranslate nohighlight">\(b\)</span>
into <span class="math notranslate nohighlight">\(g\)</span> equally sized segments. Each segment is <span class="math notranslate nohighlight">\((b - a) / g\)</span>
long. Let the boundaries of these segments be <span class="math notranslate nohighlight">\(x_0 = a\)</span>, <span class="math notranslate nohighlight">\(x_1\)</span>,
<span class="math notranslate nohighlight">\(x_1\)</span>, … , <span class="math notranslate nohighlight">\(x_g = b\)</span>. The polyline approximating the curve will
have coordinates <span class="math notranslate nohighlight">\((x_0, f(x_0))\)</span>,  <span class="math notranslate nohighlight">\((x_1, f(x_1))\)</span>, <span class="math notranslate nohighlight">\((x_2,
f(x_2))\)</span>, …, <span class="math notranslate nohighlight">\((x_g, f(x_g))\)</span>.</p>
<p>The area is then given by this formula, which sums the area of all trapezoids:</p>
<img alt="Basic Formula" class="align-center" src="../_images/math1.png"/>
<p>If we apply that formula unthinkingly, we will evaluate the function twice for
each value of x, except the first and the last values. While the correct
result would be obtained, it is inefficient and kind of defeats the purpose of
going parallel. A little manipulation gives us the following:</p>
<img alt='Parallel "Friendly" Formula' class="align-center" src="../_images/math2.png"/>
<p>We’ve now reduced the problem to computing the parallel sum term, which is
represented nicely in Scala.</p>
<p>We present three solutions in Scala:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">integrateSequential()</span></code>: The sequential (i.e. not parallel) solution is aimed at showcasing one of
the key benefits of functional programming in general. In many cases, the code closely follows the mathematics
you write. Because the code is clear in terms of its intentions, we can adapt the solution for parallel
execution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">integrateParallel()</span></code>: The parallel version shows how to get parallel speedup in Scala from the
sequential one, simply by adding <code class="docutils literal notranslate"><span class="pre">par</span></code>.</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">integrateParallelGranular()</span></code>: This version shows how to combine parallel and serial execution. By</dt><dd><p>allowing the user to specify the grain size (number of retangles to do sequentially at a time),
it is possible to determine how Scala itself might be chunking the work in the <code class="docutils literal notranslate"><span class="pre">integrateParallel()</span></code>
solution.</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="download-the-code">
<h2>Download the Code<a class="headerlink" href="#download-the-code" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#download-the-code'">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/LoyolaChicagoCode/integration-scala</span></code></p>
</section>
<section id="going-scala">
<h2>Going Scala!<a class="headerlink" href="#going-scala" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#going-scala'">¶</a></h2>
<p>Let’s start by looking at <code class="docutils literal notranslate"><span class="pre">integrateSequential()</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="linenos">1</span>  <span class="k">def</span><span class="w"> </span><span class="nf">integrateSequential</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">rectangles</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">Fx</span><span class="p">):</span> <span class="n">Double</span> <span class="o">=</span>
</span><span id="line-2"><span class="linenos">2</span>    <span class="n">val</span> <span class="n">interval</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">rectangles</span>
</span><span id="line-3"><span class="linenos">3</span>    <span class="n">val</span> <span class="n">fxValues</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="n">until</span> <span class="n">rectangles</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">n</span> <span class="o">=&gt;</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">interval</span><span class="p">)</span> <span class="p">}</span>
</span><span id="line-4"><span class="linenos">4</span>    <span class="n">interval</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">fxValues</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
</span></code></pre></div>
</div>
<p>As would be expected, we should be write this the way we think of the problem mathematically:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>: The endpoints of the integration interval</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rectangles</span></code>: The number of rectangles to use to approximate the integral</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">f</span></code>: The function to be integrated.</p></li>
</ul>
<p>In the last case, this is where Scala makes our work particularly easy by allowing us to
define a proper function type as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="linenos">1</span>  <span class="nb">type</span> <span class="n">Fx</span> <span class="o">=</span> <span class="n">Double</span> <span class="o">=&gt;</span> <span class="n">Double</span>
</span></code></pre></div>
</div>
<p>In our previous Java work (in the book), we had to use Java <em>interfaces</em> for
this same task. While seemingly just <em>syntactic sugar</em>, Java’s boilerplate is
offputting to computational scientists, who would rather use C and FORTRAN
where function parameters are possible. Unlike those choices, however, Scala
gives us the compelling aspect of <em>full type checking</em>, which means that we
can be assured of excellent performance without the complexity–and sometimes
unsafe behavior–that is found in other languages.</p>
<p>Because it is essential to understand the sequential version (the core
algorithm) before proceeding, we offer a brief  explanation of each line of
code, even when obvious, and how we are taking advantage of Scala (when less
obvious!)</p>
<ul class="simple">
<li><p>In line 2, we calculate <code class="docutils literal notranslate"><span class="pre">interval</span></code> using the formula that was presented
earlier. Scala, being pragmatic, is able to do the right thing and treat the
entire expression as Double, resulting in a Double value. Scala really shines
here by not requiring us to declare every val type, owing to its innate type
inferencing mechanism. This results in code that is much easier to comprehend
(at least we like to think so).</p></li>
<li><p>In line 3, this requires a bit more explanation. Working from our equation,
recall that our summation term goes from 1 to the number of rectangles minus
0. We use Scala’s until to get the indices. When <code class="docutils literal notranslate"><span class="pre">rectangles</span></code> is small, this
is fine. What happens when it is large? The answer depends on whether we are
using eager or lazy evaluation. In mathematical/scientific computing, we often
need to do a large number of iterations to get a better answer. This is where
the <code class="docutils literal notranslate"><span class="pre">view</span></code> comes in. It gives us a lazy sequence that can then be mapped
(also lazily) using the user-supplied function, <code class="docutils literal notranslate"><span class="pre">f</span></code>.</p></li>
<li><p>In line 4, we are able to plug everything into the derived formular for
calculating the trapezoidal integration. Technically, we could have put the
<code class="docutils literal notranslate"><span class="pre">fxValues</span></code> val definition in the same line of code, but having it separate
makes it easier to  understand for new Scala users (one of the goals for our
SIGCSE workshop). More importantly, you should be able to write the code this
way and not have to worry about losing performance. By setting up this lazy
computation, we’re able to compute the sum <em>on demand</em>. Aside from this split,
the code here exactly matches the formula we derived for performing
trapezoidal integration.</p></li>
</ul>
<p>The sequential version of integration presented here is completely side-effect
free. That is, all of the work is being done without mutating state. This
means that it can immmediately be turned into something parallel in Scala,
provided we know where the actual work is being done. Let’s continue this
exploration!</p>
</section>
<section id="going-parallel">
<h2>Going Parallel<a class="headerlink" href="#going-parallel" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#going-parallel'">¶</a></h2>
<p>The immediately preceding discussion was presented with great care, because
what we are about to demonstrate illustrates how one needs to do very little
work to take what is sometimes known as an <em>embarrassingly parallel</em> algorithm
and make it run in parallel. The term <em>embarrassing</em> is a tad misleading. As
we’ll see, the results don’t always follow your intuition. Furthermore, while
the results can be gotten quickly, it doesn’t always mean that you are getting
the best results possible. For example, as well as Scala does, it still
doesn’t do nearly as well as our hand-coded multithreaded Java example from
HPJPC. We’ll say more about this later.</p>
<p>Let’s look at the parallel version.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="linenos">1</span>  <span class="k">def</span><span class="w"> </span><span class="nf">integrateParallel</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">rectangles</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">Fx</span><span class="p">):</span> <span class="n">Double</span> <span class="o">=</span>
</span><span id="line-2"><span class="linenos">2</span>    <span class="n">val</span> <span class="n">interval</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">rectangles</span>
</span><span id="line-3"><span class="linenos">3</span>    <span class="n">val</span> <span class="n">fxValues</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="n">until</span> <span class="n">rectangles</span><span class="p">)</span><span class="o">.</span><span class="n">view</span> <span class="nb">map</span> <span class="p">{</span> <span class="n">n</span> <span class="o">=&gt;</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">interval</span><span class="p">)</span> <span class="p">}</span>
</span><span id="line-4"><span class="linenos">4</span>    <span class="n">interval</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">fxValues</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
</span></code></pre></div>
</div>
<p>In this version, observe that we have added the <code class="docutils literal notranslate"><span class="pre">par</span></code> method call just
before generating the lazy <code class="docutils literal notranslate"><span class="pre">view</span></code>. This is the only sensible place to add
<code class="docutils literal notranslate"><span class="pre">par</span></code>, because in mathematical/scientific computing, we know that most of
the parallel potential is found <em>where the loops are</em>. The <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">until</span>
<span class="pre">rectangles</span></code> is where the actual workload is being generated, so it is a
natural place to suggest <code class="docutils literal notranslate"><span class="pre">par</span></code>.</p>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#testing'">¶</a></h2>
<p>The following code shows the unit tests for our various <em>integration</em> examples.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="linenos"> 1</span><span class="n">package</span> <span class="n">edu</span><span class="o">.</span><span class="n">luc</span><span class="o">.</span><span class="n">etl</span><span class="o">.</span><span class="n">sigcse13</span><span class="o">.</span><span class="n">scala</span><span class="o">.</span><span class="n">integration</span>
</span><span id="line-2"><span class="linenos"> 2</span>
</span><span id="line-3"><span class="linenos"> 3</span><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Test</span>
</span><span id="line-4"><span class="linenos"> 4</span><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Assert.</span><span class="o">*</span>
</span><span id="line-5"><span class="linenos"> 5</span><span class="kn">import</span><span class="w"> </span><span class="nn">Integration.</span><span class="o">*</span>
</span><span id="line-6"><span class="linenos"> 6</span><span class="kn">import</span><span class="w"> </span><span class="nn">Fixtures.</span><span class="o">*</span>
</span><span id="line-7"><span class="linenos"> 7</span>
</span><span id="line-8"><span class="linenos"> 8</span><span class="o">/**</span>
</span><span id="line-9"><span class="linenos"> 9</span>  <span class="o">*</span> <span class="n">Simple</span> <span class="n">JUnit</span><span class="o">-</span><span class="n">based</span> <span class="n">tests</span><span class="o">.</span>
</span><span id="line-10"><span class="linenos">10</span>  <span class="o">*/</span>
</span><span id="line-11"><span class="linenos">11</span><span class="k">class</span><span class="w"> </span><span class="nc">Tests</span><span class="p">:</span>
</span><span id="line-12"><span class="linenos">12</span>
</span><span id="line-13"><span class="linenos">13</span>  <span class="nd">@Test</span> <span class="k">def</span><span class="w"> </span><span class="nf">testSequential</span><span class="p">():</span> <span class="n">Unit</span> <span class="o">=</span>
</span><span id="line-14"><span class="linenos">14</span>    <span class="n">assertEquals</span><span class="p">(</span><span class="mf">333.3</span><span class="p">,</span> <span class="n">integrateSequential</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">sqr</span><span class="p">),</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="line-15"><span class="linenos">15</span>
</span><span id="line-16"><span class="linenos">16</span>  <span class="nd">@Test</span> <span class="k">def</span><span class="w"> </span><span class="nf">testParallel</span><span class="p">():</span> <span class="n">Unit</span> <span class="o">=</span>
</span><span id="line-17"><span class="linenos">17</span>    <span class="n">assertEquals</span><span class="p">(</span><span class="mf">333.3</span><span class="p">,</span> <span class="n">integrateParallel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">sqr</span><span class="p">),</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="line-18"><span class="linenos">18</span>
</span><span id="line-19"><span class="linenos">19</span>  <span class="nd">@Test</span> <span class="k">def</span><span class="w"> </span><span class="nf">testParallelGranular</span><span class="p">():</span> <span class="n">Unit</span> <span class="o">=</span>
</span><span id="line-20"><span class="linenos">20</span>    <span class="n">assertEquals</span><span class="p">(</span><span class="mf">333.3</span><span class="p">,</span> <span class="n">integrateParallelGranular</span><span class="p">(</span><span class="mi">10</span><span class="p">)(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">sqr</span><span class="p">),</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="line-21"><span class="linenos">21</span>
</span><span id="line-22"><span class="linenos">22</span><span class="n">end</span> <span class="n">Tests</span>
</span></code></pre></div>
</div>
<p>For the purpose of testing, we set up <span class="math notranslate nohighlight">\(f(x) = x^2\)</span> and integrated it
from 0 to 10. The value of this integral should be 333.333333333….</p>
<p>We can’t stress enough the importance of unit tests, especially when working a
sequential algorithm into a parallel one. While you are less likely to make
mistakes in Scala, it is very easy when trying certain strategies to get the
wrong answer. (In fact, one of them, the third, gave an incorrect answer
during testing, simply because of a division error I made when computing the
number of workers!)</p>
<p>Using the notion of a test fixture, it is possible to specify what function we
wish to test without contaminating the general-purpose code we wrote with a
specific function to be integrated. See below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="linenos">1</span><span class="n">package</span> <span class="n">edu</span><span class="o">.</span><span class="n">luc</span><span class="o">.</span><span class="n">etl</span><span class="o">.</span><span class="n">sigcse13</span><span class="o">.</span><span class="n">scala</span><span class="o">.</span><span class="n">integration</span>
</span><span id="line-2"><span class="linenos">2</span>
</span><span id="line-3"><span class="linenos">3</span><span class="o">//</span> <span class="n">begin</span><span class="o">-</span><span class="nb">object</span><span class="o">-</span><span class="n">Fixtures</span>
</span><span id="line-4"><span class="linenos">4</span><span class="nb">object</span> <span class="n">Fixtures</span><span class="p">:</span>
</span><span id="line-5"><span class="linenos">5</span>  <span class="k">def</span><span class="w"> </span><span class="nf">sqr</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Double</span><span class="p">):</span> <span class="n">Double</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
</span><span id="line-6"><span class="linenos">6</span><span class="n">end</span> <span class="n">Fixtures</span>
</span><span id="line-7"><span class="linenos">7</span><span class="o">//</span> <span class="n">end</span><span class="o">-</span><span class="nb">object</span><span class="o">-</span><span class="n">Fixtures</span>
</span></code></pre></div>
</div>
</section>
<section id="running">
<h2>Running<a class="headerlink" href="#running" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#running'">¶</a></h2>
<p>The tradition of scientific computing is one where users <em>want</em> and <em>need</em> to
be able to run it from the command-line, often in an unattended fashion (say,
on a computing cluster or network of workstations or cloud resources). The
following is the main program we put together to run the integration of
<span class="math notranslate nohighlight">\(f(x) = x^2\)</span> manually. You can specify the number of rectangles, the
number of times to run each of the experiments, and a grain size for testing
the combined parallel/sequential version, <code class="docutils literal notranslate"><span class="pre">integrateParallelGranular()</span></code>.
We’ll say more about this function in our performance discussion.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="linenos"> 1</span><span class="n">package</span> <span class="n">edu</span><span class="o">.</span><span class="n">luc</span><span class="o">.</span><span class="n">etl</span><span class="o">.</span><span class="n">sigcse13</span><span class="o">.</span><span class="n">scala</span><span class="o">.</span><span class="n">integration</span>
</span><span id="line-2"><span class="linenos"> 2</span>
</span><span id="line-3"><span class="linenos"> 3</span><span class="kn">import</span><span class="w"> </span><span class="nn">Integration.</span><span class="o">*</span>
</span><span id="line-4"><span class="linenos"> 4</span><span class="kn">import</span><span class="w"> </span><span class="nn">Fixtures.sqr</span>
</span><span id="line-5"><span class="linenos"> 5</span>
</span><span id="line-6"><span class="linenos"> 6</span><span class="nb">object</span> <span class="n">Main</span><span class="p">:</span>
</span><span id="line-7"><span class="linenos"> 7</span>
</span><span id="line-8"><span class="linenos"> 8</span>  <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Array</span><span class="p">[</span><span class="n">String</span><span class="p">]):</span> <span class="n">Unit</span> <span class="o">=</span>
</span><span id="line-9"><span class="linenos"> 9</span>    <span class="k">try</span>
</span><span id="line-10"><span class="linenos">10</span>      <span class="n">require</span> <span class="p">{</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">args</span><span class="o">.</span><span class="n">length</span> <span class="p">}</span>
</span><span id="line-11"><span class="linenos">11</span>      <span class="n">val</span> <span class="n">rectangles</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toInt</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</span><span id="line-12"><span class="linenos">12</span>      <span class="n">val</span> <span class="n">n</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toInt</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="line-13"><span class="linenos">13</span>      <span class="n">val</span> <span class="n">grainSize</span> <span class="o">=</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">3</span> <span class="n">then</span> <span class="n">math</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">toInt</span><span class="p">,</span> <span class="n">rectangles</span><span class="p">)</span> <span class="k">else</span> <span class="n">rectangles</span>
</span><span id="line-14"><span class="linenos">14</span>
</span><span id="line-15"><span class="linenos">15</span>      <span class="n">timedRun</span><span class="p">(</span><span class="n">rectangles</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="s2">"sequentially"</span><span class="p">,</span> <span class="n">integrateSequential</span><span class="p">)</span>
</span><span id="line-16"><span class="linenos">16</span>      <span class="n">timedRun</span><span class="p">(</span><span class="n">rectangles</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="s2">"in parallel"</span><span class="p">,</span> <span class="n">integrateParallel</span><span class="p">)</span>
</span><span id="line-17"><span class="linenos">17</span>      <span class="n">timedRun</span><span class="p">(</span><span class="n">rectangles</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="s2">"in parallel with "</span> <span class="o">+</span> <span class="n">grainSize</span> <span class="o">+</span>
</span><span id="line-18"><span class="linenos">18</span>        <span class="s2">" rectangles per serial worker"</span><span class="p">,</span> <span class="n">integrateParallelGranular</span><span class="p">(</span><span class="n">grainSize</span><span class="p">))</span>
</span><span id="line-19"><span class="linenos">19</span>
</span><span id="line-20"><span class="linenos">20</span>    <span class="n">catch</span>
</span><span id="line-21"><span class="linenos">21</span>      <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span> <span class="n">NumberFormatException</span>    <span class="o">=&gt;</span> <span class="n">usage</span><span class="p">()</span>
</span><span id="line-22"><span class="linenos">22</span>      <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span> <span class="n">IllegalArgumentException</span> <span class="o">=&gt;</span> <span class="n">usage</span><span class="p">()</span>
</span><span id="line-23"><span class="linenos">23</span>
</span><span id="line-24"><span class="linenos">24</span>  <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">():</span> <span class="n">Unit</span> <span class="o">=</span>
</span><span id="line-25"><span class="linenos">25</span>    <span class="n">Console</span><span class="o">.</span><span class="n">err</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">"usage: rectangles (&gt;= 1000) "</span> <span class="o">+</span>
</span><span id="line-26"><span class="linenos">26</span>      <span class="s2">"numberOfRuns (&gt;= 1) [ grainSize (rectangles </span><span class="si">% g</span><span class="s2">rainSize == 0) ]"</span><span class="p">)</span>
</span><span id="line-27"><span class="linenos">27</span>
</span><span id="line-28"><span class="linenos">28</span>  <span class="k">def</span><span class="w"> </span><span class="nf">timeThis</span><span class="p">[</span><span class="n">A</span><span class="p">](</span><span class="n">s</span><span class="p">:</span> <span class="n">String</span><span class="p">)(</span><span class="n">block</span><span class="p">:</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="p">):</span> <span class="n">A</span> <span class="o">=</span>
</span><span id="line-29"><span class="linenos">29</span>    <span class="n">val</span> <span class="n">time0</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">currentTimeMillis</span>
</span><span id="line-30"><span class="linenos">30</span>    <span class="n">val</span> <span class="n">b</span> <span class="o">=</span> <span class="n">block</span>
</span><span id="line-31"><span class="linenos">31</span>    <span class="n">val</span> <span class="n">time1</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">currentTimeMillis</span> <span class="o">-</span> <span class="n">time0</span>
</span><span id="line-32"><span class="linenos">32</span>    <span class="n">println</span><span class="p">(</span><span class="s2">"Timing "</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s2">" = "</span> <span class="o">+</span> <span class="n">time1</span><span class="p">)</span>
</span><span id="line-33"><span class="linenos">33</span>    <span class="n">b</span>
</span><span id="line-34"><span class="linenos">34</span>
</span><span id="line-35"><span class="linenos">35</span>  <span class="o">//</span> <span class="n">begin</span><span class="o">-</span><span class="n">timedRun</span>
</span><span id="line-36"><span class="linenos">36</span>  <span class="k">def</span><span class="w"> </span><span class="nf">timedRun</span><span class="p">(</span><span class="n">rectangles</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">how</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
</span><span id="line-37"><span class="linenos">37</span>      <span class="n">integrationStrategy</span><span class="p">:</span> <span class="p">(</span><span class="n">Double</span><span class="p">,</span> <span class="n">Double</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">Fx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">Double</span><span class="p">):</span> <span class="n">Unit</span> <span class="o">=</span>
</span><span id="line-38"><span class="linenos">38</span>    <span class="n">timeThis</span><span class="p">(</span><span class="n">how</span><span class="p">):</span>
</span><span id="line-39"><span class="linenos">39</span>      <span class="nb">print</span><span class="p">(</span><span class="s2">"Computing area "</span> <span class="o">+</span> <span class="n">how</span> <span class="o">+</span> <span class="s2">"; now timing "</span> <span class="o">+</span> <span class="n">n</span> <span class="o">+</span> <span class="s2">" iterations"</span><span class="p">)</span>
</span><span id="line-40"><span class="linenos">40</span>      <span class="n">val</span> <span class="n">area</span><span class="p">:</span> <span class="n">Double</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="n">to</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">_</span> <span class="o">=&gt;</span> <span class="n">integrationStrategy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">rectangles</span><span class="p">,</span> <span class="n">sqr</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">head</span>
</span><span id="line-41"><span class="linenos">41</span>      <span class="n">println</span><span class="p">(</span><span class="s2">"; area = "</span> <span class="o">+</span> <span class="n">area</span><span class="p">)</span>
</span><span id="line-42"><span class="linenos">42</span>
</span><span id="line-43"><span class="linenos">43</span>  <span class="o">//</span> <span class="n">end</span><span class="o">-</span><span class="n">timedRun</span>
</span><span id="line-44"><span class="linenos">44</span><span class="n">end</span> <span class="n">Main</span>
</span></code></pre></div>
</div>
</section>
<section id="initial-experiments-with-performance">
<h2>Initial Experiments with Performance<a class="headerlink" href="#initial-experiments-with-performance" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#initial-experiments-with-performance'">¶</a></h2>
<p>This is still being written up but will be demonstrated live.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="linenos">1</span>  <span class="k">def</span><span class="w"> </span><span class="nf">integrateParallelGranular</span><span class="p">(</span><span class="n">grainSize</span><span class="p">:</span> <span class="n">Int</span><span class="p">)(</span><span class="n">a</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">rectangles</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">Fx</span><span class="p">):</span> <span class="n">Double</span> <span class="o">=</span>
</span><span id="line-2"><span class="linenos">2</span>    <span class="n">require</span> <span class="p">{</span> <span class="n">rectangles</span> <span class="o">%</span> <span class="n">grainSize</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">}</span> <span class="o">//</span> <span class="n">can</span> <span class="n">relax</span> <span class="n">this</span> <span class="n">later</span>
</span><span id="line-3"><span class="linenos">3</span>    <span class="n">val</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">rectangles</span> <span class="o">/</span> <span class="n">grainSize</span>
</span><span id="line-4"><span class="linenos">4</span>    <span class="n">val</span> <span class="n">interval</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">workers</span>
</span><span id="line-5"><span class="linenos">5</span>    <span class="n">val</span> <span class="n">fullIntegration</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="n">until</span> <span class="n">workers</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">map</span><span class="p">:</span>
</span><span id="line-6"><span class="linenos">6</span>      <span class="n">n</span> <span class="o">=&gt;</span>
</span><span id="line-7"><span class="linenos">7</span>        <span class="n">val</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">interval</span>
</span><span id="line-8"><span class="linenos">8</span>        <span class="n">integrateSequential</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="n">interval</span><span class="p">,</span> <span class="n">grainSize</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="line-9"><span class="linenos">9</span>    <span class="n">fullIntegration</span><span class="o">.</span><span class="n">sum</span>
</span></code></pre></div>
</div>
</section>
<section id="previous-work">
<h2>Previous Work<a class="headerlink" href="#previous-work" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#previous-work'">¶</a></h2>
<p>This example was developed as part of High-Performance Java Platform Computing
by Thomas W. Christopher and George K. Thiruvathukal.</p>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p><a href="#id2"><span class="problematic" id="id3">|pdf|</span></a> PDF of Book
<a class="reference external" href="https://hpjpc.googlecode.com/files/HPJPC%20Christopher%20and%20Thiruvathukal.pdf">https://hpjpc.googlecode.com/files/HPJPC%20Christopher%20and%20Thiruvathukal.pdf</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/LoyolaChicagoCode/hpjpc-source-java</span></code></p>
</section>
</section>
</div></div><aside class="hidden text-sm xl:block" id="right-sidebar">
<div class="sticky top-16 -mt-10 max-h-[calc(100vh-5rem)] overflow-y-auto pt-6 space-y-2"><p class="font-medium">On this page</p>
<ul>
<li><a :data-current="activeSection === '#example-trapezoidal-numeric-integration'" class="reference internal" href="#example-trapezoidal-numeric-integration">Example: Trapezoidal Numeric Integration</a></li>
<li><a :data-current="activeSection === '#download-the-code'" class="reference internal" href="#download-the-code">Download the Code</a></li>
<li><a :data-current="activeSection === '#going-scala'" class="reference internal" href="#going-scala">Going Scala!</a></li>
<li><a :data-current="activeSection === '#going-parallel'" class="reference internal" href="#going-parallel">Going Parallel</a></li>
<li><a :data-current="activeSection === '#testing'" class="reference internal" href="#testing">Testing</a></li>
<li><a :data-current="activeSection === '#running'" class="reference internal" href="#running">Running</a></li>
<li><a :data-current="activeSection === '#initial-experiments-with-performance'" class="reference internal" href="#initial-experiments-with-performance">Initial Experiments with Performance</a></li>
<li><a :data-current="activeSection === '#previous-work'" class="reference internal" href="#previous-work">Previous Work</a></li>
</ul>
</div>
</aside>
</main>
</div>
</div><footer class="py-6 border-t border-border md:py-0">
<div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
<div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
<p class="text-sm leading-loose text-center text-muted-foreground md:text-left">© 2012-Present, Konstantin Läufer and George K. Thiruvathukal Built with <a class="font-medium underline underline-offset-4" href="https://www.sphinx-doc.org" rel="noreferrer">Sphinx 8.2.3</a></p>
</div>
</div>
</footer>
</div>
<script src="../_static/documentation_options.js?v=5b3c63aa"></script>
<script src="../_static/doctools.js?v=9bcbadda"></script>
<script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
<script defer="defer" src="../_static/theme.js?v=073f68d9"></script>
<script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>